{% extends 'base.html' %}
{% block title %}Presentacion · {{ resource.title }}{% endblock %}
{% block content %}
<section class="tools-present-hero p-4 mb-3 reveal">
    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
        <div>
            <p class="small text-uppercase mb-1 opacity-75">Biblioteca · Presentacion</p>
            <h1 class="h3 mb-1">{{ resource.title }}</h1>
            <p class="mb-0 opacity-75">{{ resource.provider|default:"Interno" }} · {{ resource.source_label }}</p>
        </div>
        <div class="d-flex flex-wrap gap-2">
            <a href="{% url 'dashboard:tools' %}" class="btn btn-light">Volver a Biblioteca</a>
            {% if previous_resource %}
            <a href="{% url 'dashboard:tools_resource_present' previous_resource.pk %}" class="btn btn-outline-light">Anterior</a>
            {% endif %}
            {% if next_resource %}
            <a href="{% url 'dashboard:tools_resource_present' next_resource.pk %}" class="btn btn-outline-light">Siguiente</a>
            {% endif %}
        </div>
    </div>
</section>

<div class="row g-3 mb-3">
    <div class="col-12 col-md-6 col-xl-3">
        <article class="section-card p-3 h-100 reveal reveal-delay-1">
            <p class="tools-metric-label mb-1">Publicado por</p>
            <p class="mb-0 fw-semibold">{{ resource.created_by.get_full_name|default:resource.created_by.username }}</p>
        </article>
    </div>
    <div class="col-12 col-md-6 col-xl-3">
        <article class="section-card p-3 h-100 reveal reveal-delay-1">
            <p class="tools-metric-label mb-1">Fecha</p>
            <p class="mb-0 fw-semibold">{{ resource.created_at|date:"d/m/Y H:i" }}</p>
        </article>
    </div>
    <div class="col-12 col-md-6 col-xl-3">
        <article class="section-card p-3 h-100 reveal reveal-delay-2">
            <p class="tools-metric-label mb-1">Estado</p>
            <p class="mb-0 fw-semibold">{% if resource.is_active %}Activo{% else %}Inactivo{% endif %}</p>
        </article>
    </div>
    <div class="col-12 col-md-6 col-xl-3">
        <article class="section-card p-3 h-100 reveal reveal-delay-2">
            <p class="tools-metric-label mb-1">Tags</p>
            <p class="mb-0 fw-semibold">
                {% if resource.tags.all %}
                {% for tag in resource.tags.all %}
                <span class="badge text-bg-light me-1">{{ tag.name }}</span>
                {% endfor %}
                {% else %}
                Sin tags
                {% endif %}
            </p>
        </article>
    </div>
</div>

<section class="section-card p-4 reveal reveal-delay-3">
    <div class="d-flex flex-wrap justify-content-between align-items-start gap-2 mb-3">
        <div>
            <h2 class="h5 mb-1">Vista de presentación</h2>
            {% if resource.description %}
            <p class="mb-0 text-muted">{{ resource.description }}</p>
            {% endif %}
        </div>
        <div class="d-flex flex-wrap gap-2">
            {% if original_url %}
            <a href="{{ original_url }}" target="_blank" rel="noopener" class="btn btn-sm btn-outline-primary">Abrir original</a>
            {% endif %}
            <button type="button" id="copy-present-link-btn" class="btn btn-sm btn-outline-secondary">Copiar enlace</button>
            {% if embed_url %}
            <button type="button" id="present-fullscreen-btn" class="btn btn-sm btn-primary">Pantalla completa</button>
            {% endif %}
        </div>
    </div>

    {% if embed_url %}
    <div class="tools-iframe-wrap tools-iframe-stage" id="tools-iframe-stage">
        <iframe
            src="{{ embed_url }}"
            title="Presentacion de {{ resource.title }}"
            loading="lazy"
            allow="autoplay; fullscreen; encrypted-media; picture-in-picture"
            referrerpolicy="origin"
            allowfullscreen
        ></iframe>
    </div>
    {% else %}
    <div class="alert alert-warning mb-0">Este recurso no permite visualización embebida. Usa el botón "Abrir original".</div>
    {% endif %}
</section>
{% endblock %}
{% block extra_js %}
<script>
(function () {
    const copyBtn = document.getElementById('copy-present-link-btn');
    if (copyBtn) {
        copyBtn.addEventListener('click', async function () {
            try {
                await navigator.clipboard.writeText(window.location.href);
                copyBtn.textContent = 'Enlace copiado';
                setTimeout(function () { copyBtn.textContent = 'Copiar enlace'; }, 1500);
            } catch (err) {
                copyBtn.textContent = 'No se pudo copiar';
                setTimeout(function () { copyBtn.textContent = 'Copiar enlace'; }, 1500);
            }
        });
    }

    const fullscreenBtn = document.getElementById('present-fullscreen-btn');
    const stage = document.getElementById('tools-iframe-stage');
    if (fullscreenBtn && stage) {
        fullscreenBtn.addEventListener('click', function () {
            const requestFullscreen = stage.requestFullscreen || stage.webkitRequestFullscreen || stage.msRequestFullscreen;
            if (requestFullscreen) requestFullscreen.call(stage);
        });
    }
})();
</script>
{% endblock %}
