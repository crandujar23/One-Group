{% if global_announcement_slides %}
<section class="section-card p-3 mb-3 reveal">
    <div class="d-flex justify-content-between align-items-center gap-2 mb-3">
        <h2 class="h5 mb-0">Anuncios vigentes</h2>
        <span class="small text-muted">{{ global_announcement_slides|length }} activo{{ global_announcement_slides|length|pluralize }}</span>
    </div>
    <div
        id="announcementCarousel"
        class="carousel slide announcement-carousel"
        data-bs-ride="carousel"
        data-bs-interval="5000"
        data-bs-touch="true"
        data-bs-pause="false"
    >
        <div class="carousel-indicators">
            {% for slide in global_announcement_slides %}
            <button
                type="button"
                data-bs-target="#announcementCarousel"
                data-bs-slide-to="{{ forloop.counter0 }}"
                {% if forloop.first %}class="active" aria-current="true"{% endif %}
                aria-label="Anuncio {{ forloop.counter }}"
            ></button>
            {% endfor %}
        </div>
        <div class="carousel-inner rounded-4 overflow-hidden border">
            {% for slide in global_announcement_slides %}
            {% with announcement=slide.announcement %}
            <article class="carousel-item {% if forloop.first %}active{% endif %}">
                <div class="p-3 p-md-4 bg-white">
                    {% if announcement.media_type == "video" and slide.video_embed_url %}
                    <div class="ratio ratio-16x9 rounded-3 overflow-hidden bg-dark">
                        <iframe
                            src="{{ slide.video_embed_url }}"
                            title="Video de anuncio"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowfullscreen
                            referrerpolicy="strict-origin-when-cross-origin"
                        ></iframe>
                    </div>
                    {% elif announcement.media_type == "pdf" and announcement.media_file %}
                    <div class="ratio ratio-16x9 rounded-3 overflow-hidden bg-light border">
                        <iframe
                            src="{{ announcement.media_file.url }}"
                            title="PDF de anuncio"
                            loading="lazy"
                        ></iframe>
                    </div>
                    <p class="small text-muted mt-2 mb-0">
                        Si no se visualiza el PDF, abre el archivo directamente:
                        <a href="{{ announcement.media_file.url }}" target="_blank" rel="noopener">Abrir PDF</a>
                    </p>
                    {% elif announcement.media_type == "image" and announcement.media_file %}
                    <div class="text-center bg-light rounded-3 border p-2">
                        <img
                            src="{{ announcement.media_file.url }}"
                            alt="{{ announcement.title }}"
                            class="img-fluid rounded-2"
                            style="max-height: 480px; width: auto;"
                        >
                    </div>
                    {% endif %}

                    <div class="d-flex flex-column flex-md-row justify-content-between gap-2 mt-3">
                        <div>
                            <h3 class="h5 mb-1">{{ announcement.title }}</h3>
                            <div class="mb-0 text-muted">{{ announcement.message|safe }}</div>
                        </div>
                        <span class="small text-muted">{{ announcement.start_date|date:"d/m/Y" }} - {{ announcement.end_date|date:"d/m/Y" }}</span>
                    </div>
                </div>
            </article>
            {% endwith %}
            {% endfor %}
        </div>
        {% if global_announcement_slides|length > 1 %}
        <button class="carousel-control-prev" type="button" data-bs-target="#announcementCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon announcement-carousel-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#announcementCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon announcement-carousel-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Siguiente</span>
        </button>
        {% endif %}
    </div>
</section>
{% endif %}
